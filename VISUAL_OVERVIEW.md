# 🎨 ВИЗУАЛЬНЫЙ ОБЗОР СИСТЕМЫ

Этот документ содержит визуальные представления системы презентаций.

## 🎬 Скриншоты функциональности

### Для Организатора (OrganizerDashboard)

```
┌─────────────────────────────────────────────────────────────┐
│ OrganizerDashboard                                          │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  Выбрана свадьба: "Марина & Игорь"                         │
│                                                               │
│  ┌──────────────────────────────────────────────────┐       │
│  │ Презентации                     [+ Загрузить]     │       │
│  ├──────────────────────────────────────────────────┤       │
│  │                                                   │       │
│  │ ┌─────────────────────────────────────────────┐ │       │
│  │ │ Ольга Португалия              [×]          │ │       │
│  │ │ 3 раздела • 10.5MB                         │ │       │
│  │ │                                             │ │       │
│  │ │ Разделы:                                   │ │       │
│  │ │ [Концепция (стр. 3)] [Стиль (стр. 5)]     │ │       │
│  │ │ [Еда (стр. 8)]                             │ │       │
│  │ └─────────────────────────────────────────────┘ │       │
│  │                                                   │       │
│  │ ┌─────────────────────────────────────────────┐ │       │
│  │ │ Марина и Игорь                [×]          │ │       │
│  │ │ 1 раздел • 15.2MB                         │ │       │
│  │ │                                             │ │       │
│  │ │ Разделы:                                   │ │       │
│  │ │ [Сценарий (стр. 1)]                        │ │       │
│  │ └─────────────────────────────────────────────┘ │       │
│  │                                                   │       │
│  └──────────────────────────────────────────────────┘       │
│                                                               │
└─────────────────────────────────────────────────────────────┘

При нажатии [+ Загрузить]:

┌─────────────────────────────────────────────────────────────┐
│ Загрузить презентацию                                   [×]  │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  Название презентации *                                     │
│  [_________________________________]                        │
│  "Например: 'Ольга Португалия' или 'Свадьба Марины...'"   │
│                                                               │
│  PDF файл *                                                 │
│  [Выбрать файл]                                             │
│  📄 presentation.pdf (28.5MB)                               │
│                                                               │
│  Части презентации (опционально)                            │
│  Добавьте названия разделов с номерами страниц              │
│                                                               │
│  [Концепция____] [3____] [+]                               │
│  [Стиль________] [5____] [+]                               │
│  [Еда__________] [8____] [+]                               │
│                                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ✓ Концепция                          Страница 3  [×]   │
│  │ ✓ Стиль                              Страница 5  [×]   │
│  │ ✓ Еда                                Страница 8  [×]   │
│  └─────────────────────────────────────────────────────┘   │
│                                                               │
│  [Отмена]                                    [Загрузить]   │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### Для Клиента (ClientDashboard)

```
┌──────────────────────────────────────────────────────────────┐
│ Презентации                                                  │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────┐  ┌────────────────────────────────┐   │
│  │ Левая панель     │  │ Правая панель                  │   │
│  │ (аккордеон)      │  │ (PDF iframe)                   │   │
│  │                  │  │                                │   │
│  │ Ольга Португалия │  │ ╔════════════════════════════╗│   │
│  │                  │  │ ║                            ║│   │
│  │ ▼ Концепция      │→ │ ║  КОНЦЕПЦИЯ                 ║│   │
│  │   (стр. 3)       │  │ ║                            ║│   │
│  │                  │  │ ║  [Содержимое страницы 3]   ║│   │
│  │ ▼ Стиль          │→ │ ║                            ║│   │
│  │   (стр. 5)       │  │ ║                            ║│   │
│  │                  │  │ ╚════════════════════════════╝│   │
│  │ ▼ Еда            │→ │ Страница 3                     │   │
│  │   (стр. 8)       │  │                                │   │
│  │                  │  │                                │   │
│  │ Марина и Игорь  │  │                                │   │
│  │                  │  │                                │   │
│  │ ▼ Сценарий       │→ │ (PDF показывает выбранную    │   │
│  │   (стр. 1)       │  │  страницу в реальном времени)│   │
│  │                  │  │                                │   │
│  └──────────────────┘  └────────────────────────────────┘   │
│                                                                │
└──────────────────────────────────────────────────────────────┘
```

## 🎯 Процесс загрузки

```
1. Организатор нажимает "+ Загрузить"
        ↓
2. Открывается модальное окно
        ↓
3. Заполняет форму:
   ├─ Название: "Ольга Португалия"
   ├─ PDF файл: выбирает file.pdf
   └─ Разделы: добавляет название + страница
        ↓
4. Нажимает "Загрузить"
        ↓
5. presentationService.uploadPresentationPDF()
   └─ Загружает в Supabase Storage
      └─ presentations/wedding-uuid/timestamp_file.pdf
         └─ Возвращает signed URL
        ↓
6. presentationService.createPresentation()
   └─ INSERT в presentations таблицу
   └─ INSERT в presentation_sections (для каждого раздела)
        ↓
7. React Query обновляет useCustomPresentations()
        ↓
8. OrganizerPresentations обновляет список
        ↓
9. ✅ Клиент видит новую презентацию в ClientDashboard
```

## 📊 Процесс просмотра

```
1. Клиент открывает ClientDashboard
        ↓
2. useCustomPresentations() загружает данные
        ↓
3. PresentationViewer получает массив presentations
        ↓
4. Рендерит:
   ├─ Левая панель: аккордеон с презентациями
   │  ├─ Ольга Португалия
   │  │  ├─ Концепция (стр. 3)
   │  │  ├─ Стиль (стр. 5)
   │  │  └─ Еда (стр. 8)
   │  └─ Марина и Игорь
   │     └─ Сценарий (стр. 1)
   └─ Правая панель: iframe с PDF
        ↓
5. Клиент кликает на "Концепция"
        ↓
6. setCurrentPage(3)
        ↓
7. iframe переходит на страницу 3
        ↓
8. ✅ Клиент видит нужную страницу
```

## 🏗️ Архитектурная диаграмма

```
┌──────────────────────────────────────────────────────────┐
│ FRONTEND (React)                                          │
├──────────────────────────────────────────────────────────┤
│                                                            │
│  ┌──────────────┐         ┌──────────────┐              │
│  │  Organizer   │         │  Client      │              │
│  │  Dashboard   │         │  Dashboard   │              │
│  └──────────────┘         └──────────────┘              │
│         ↓                          ↓                      │
│  ┌──────────────────────────────────────────┐           │
│  │  React Components                        │           │
│  │  ├─ OrganizerPresentations               │           │
│  │  ├─ PresentationUploadModal              │           │
│  │  └─ PresentationViewer                   │           │
│  └──────────────────────────────────────────┘           │
│         ↓                          ↓                      │
│  ┌──────────────────────────────────────────┐           │
│  │  React Hooks (React Query)               │           │
│  │  └─ useCustomPresentations()             │           │
│  └──────────────────────────────────────────┘           │
│         ↓                                                │
└─────────────────────────────────────────────────────────┘
         ↓
┌──────────────────────────────────────────────────────────┐
│ API LAYER (presentationService)                           │
├──────────────────────────────────────────────────────────┤
│                                                            │
│  uploadPresentationPDF()                                 │
│  getPresentationsByWedding()                             │
│  createPresentation()                                    │
│  deletePresentation()                                    │
│  addPresentationSection()                                │
│  deletePresentationSection()                             │
│                                                            │
└──────────────────────────────────────────────────────────┘
         ↓
┌──────────────────────────────────────────────────────────┐
│ BACKEND (Supabase)                                        │
├──────────────────────────────────────────────────────────┤
│                                                            │
│  ┌─────────────────┐      ┌──────────────────┐          │
│  │ PostgreSQL      │      │ Storage Bucket   │          │
│  │                 │      │                  │          │
│  │ presentations   │      │ presentations/   │          │
│  │ ├─ id           │      │ └─ {wedding_id}/ │          │
│  │ ├─ wedding_id   │      │    └─ ...pdf     │          │
│  │ ├─ title        │      │                  │          │
│  │ ├─ pdf_url      │→→→→→→→ (signed URL)    │          │
│  │ ├─ order_index  │      │                  │          │
│  │ └─ ...          │      │                  │          │
│  │                 │      │                  │          │
│  │ presentation_   │      └──────────────────┘          │
│  │ sections        │                                     │
│  │ ├─ id           │                                     │
│  │ ├─ presentation │                                     │
│  │ ├─ title        │                                     │
│  │ ├─ page_number  │                                     │
│  │ └─ ...          │                                     │
│  │                 │                                     │
│  │ (RLS защита)    │      (Signed URLs)                 │
│  └─────────────────┘      (1 год действия)              │
│                                                            │
└──────────────────────────────────────────────────────────┘
```

## 💾 Хранилище данных

```
PostgreSQL (Supabase)
│
├─ presentations таблица
│  ├─ id: uuid
│  ├─ wedding_id: uuid (FK)
│  ├─ title: "Ольга Португалия"
│  ├─ type: "wedding"
│  ├─ pdf_url: "https://signed-url..."
│  ├─ pdf_file_path: "presentations/wedding-uuid/..."
│  ├─ is_default: false
│  ├─ order_index: 1
│  ├─ created_at: 2024-01-01T12:00:00Z
│  └─ updated_at: 2024-01-01T12:00:00Z
│
└─ presentation_sections таблица
   ├─ id: uuid
   ├─ presentation_id: uuid (FK)
   ├─ title: "Концепция"
   ├─ page_number: 3
   ├─ order_index: 0
   ├─ created_at: 2024-01-01T12:00:00Z
   └─ updated_at: 2024-01-01T12:00:00Z

Storage (Supabase)
│
└─ wedding-documents/
   └─ presentations/
      └─ {wedding-uuid}/
         ├─ 1704067200000_presentation_1.pdf (10MB)
         ├─ 1704067300000_presentation_2.pdf (15MB)
         └─ 1704067400000_presentation_3.pdf (8MB)
```

## 🔐 Безопасность

```
RLS Политики
│
├─ presentations таблица
│  ├─ SELECT: Клиент может видеть свои
│  ├─ SELECT: Организатор может видеть все
│  ├─ INSERT/UPDATE/DELETE: Только организатор своей свадьбы
│  └─ INSERT/UPDATE/DELETE: Главный организатор может все
│
└─ presentation_sections таблица
   └─ Наследует логику presentations

Storage Access
│
├─ Signed URLs (вместо прямого доступа)
├─ Ограничение по времени (1 год)
└─ Привязка к пользователю (через RLS)
```

## 📈 Производительность

```
React Query Caching
│
├─ staleTime: 5 минут
├─ Автоматическое обновление
└─ Инвалидация при изменении

Lazy Loading
│
├─ PDF в iframe (не загружается весь документ)
├─ Компоненты подгружаются по мере надобности
└─ Изображения оптимизированы

Database
│
├─ Индексы на wedding_id и presentation_id
├─ Эффективные запросы с JOIN
└─ Cascade delete для очистки
```

## ✨ Поток данных в реальном времени

```
t=0s  Пользователь нажимает "Загрузить"
      ↓
t=0.5s Открывается PresentationUploadModal
      ↓
t=5s  Пользователь выбирает PDF и добавляет разделы
      ↓
t=5.5s Нажимает "Загрузить"
      ↓
t=5.6s uploadPresentationPDF() начинает загрузку в Storage
      ↓
t=7s  Файл загружен, createPresentation() создает записи в БД
      ↓
t=7.2s React Query инвалидирует кеш
      ↓
t=7.3s useCustomPresentations() перезагружает данные
      ↓
t=8s  Список обновился в OrganizerPresentations
      ↓
t=8.1s Модал закрывается, Toast показывает "Готово!"
      ↓
t=10s Клиент открывает ClientDashboard
      ↓
t=10.5s useCustomPresentations() загружает презентации
      ↓
t=11s Данные кешируются и отображаются в PresentationViewer
      ↓
t=15s Клиент кликает на раздел "Концепция"
      ↓
t=15.1s setCurrentPage(3) срабатывает
      ↓
t=15.2s iframe переходит на страницу 3
      ↓
✅ ГОТОВО! Клиент видит нужную страницу PDF
```

## 🎨 Дизайн системы

```
Цвета:
├─ Фон: #eae6db (бежевый)
├─ Текст: #000000 (черный)
├─ Вторичный текст: #00000080 (серый)
├─ Грани: #00000033 (светло-серый)
├─ Кнопки: #000000 (черный фон)
└─ Активное: #00000015 (светло-черный)

Типография:
├─ Шрифт: Forum
├─ Размеры: от 11px до 32px
└─ Веса: light, normal, bold

Компоновка:
├─ Flex layout
├─ Grid для сложных структур
└─ Адаптивный дизайн (мобильный + десктоп)

Интерактивность:
├─ Hover эффекты
├─ Transition анимации
├─ Accordion раскрывание
└─ Modal окна
```

---

Эти визуальные представления помогают понять как работает система! 🎨

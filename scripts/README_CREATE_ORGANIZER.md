# Инструкция по созданию профиля организатора

## Шаг 1: Создайте пользователя в Authentication

1. Откройте **Supabase Dashboard**
2. Перейдите в раздел **Authentication** -> **Users**
3. Нажмите **Add user** -> **Create new user**
4. Заполните данные:
   - **Email**: `organizer@example.com` (или любой другой email)
   - **Password**: создайте надежный пароль
   - **Auto Confirm User**: включите эту опцию (чтобы не требовалось подтверждение email)
5. Нажмите **Create user**
6. **ВАЖНО: Скопируйте User ID** - он понадобится в следующем шаге

## Шаг 2: Выполните SQL скрипт

1. В Supabase Dashboard перейдите в **SQL Editor**
2. Откройте файл `scripts/create_organizer.sql`
3. Замените в скрипте:
   - `YOUR_ORGANIZER_USER_ID` на **User ID** из шага 1
   - `organizer@example.com` на реальный email (если используете другой)
   - `Имя Организатора` на реальное имя организатора
4. Выполните скрипт (нажмите **Run**)

## Шаг 3: Проверьте результат

После выполнения скрипта проверьте:

1. В таблице `profiles` должна появиться запись:
   - `role`: `organizer`
   - `email`: email, который вы указали
   - `name`: имя организатора

2. Выполните проверочный запрос (опционально):
   ```sql
   SELECT 
     id,
     email,
     name,
     role,
     created_at
   FROM profiles
   WHERE role = 'organizer';
   ```

## Вход в систему

После создания профиля организатор сможет войти в систему:

1. Откройте приложение
2. Введите:
   - **Email**: email, который был указан при создании пользователя
   - **Password**: пароль, который был установлен
3. После входа организатор будет автоматически перенаправлен на `/organizer`

## Права организатора

Профиль с ролью `organizer` предоставляет доступ к:

- ✅ Просмотру всех свадеб
- ✅ Созданию, редактированию и удалению свадеб
- ✅ Просмотру всех клиентов
- ✅ Управлению задачами для всех свадеб
- ✅ Управлению документами для всех свадеб
- ✅ Полной панели управления (`OrganizerDashboard`)

## Безопасность

- Пароль организатора должен быть надежным
- Храните учетные данные в безопасном месте
- Регулярно обновляйте пароли
- Используйте разные пароли для разных сред (development/production)

## Примеры использования

### Создание нескольких организаторов

Если вам нужно создать несколько организаторов, выполните скрипт для каждого пользователя отдельно:

1. Создайте пользователя в Authentication
2. Скопируйте его User ID
3. Выполните SQL скрипт с новым User ID

### Обновление данных организатора

Если нужно обновить данные организатора (имя, email), используйте:

```sql
UPDATE profiles
SET 
  email = 'новый_email@example.com',
  name = 'Новое Имя'
WHERE id = 'USER_ID_ОРГАНИЗАТОРА';
```

### Удаление организатора

**ВНИМАНИЕ**: Будьте осторожны при удалении организатора, так как это может затронуть связанные свадьбы.

1. Сначала проверьте, какие свадьбы связаны с организатором:
   ```sql
   SELECT id, couple_name_1_ru, couple_name_2_ru
   FROM weddings
   WHERE organizer_id = 'USER_ID_ОРГАНИЗАТОРА';
   ```

2. Если нужно, переназначьте свадьбы другому организатору:
   ```sql
   UPDATE weddings
   SET organizer_id = 'НОВЫЙ_ОРГАНИЗАТОР_ID'
   WHERE organizer_id = 'СТАРЫЙ_ОРГАНИЗАТОР_ID';
   ```

3. Удалите профиль:
   ```sql
   DELETE FROM profiles
   WHERE id = 'USER_ID_ОРГАНИЗАТОРА';
   ```

4. Удалите пользователя в Authentication через Dashboard

## Troubleshooting

### Ошибка: "violates foreign key constraint"

**Причина**: User ID не существует в таблице `auth.users`

**Решение**: Убедитесь, что вы сначала создали пользователя в Authentication и используете правильный User ID

### Ошибка: "duplicate key value"

**Причина**: Профиль с таким ID уже существует

**Решение**: Скрипт использует `ON CONFLICT DO UPDATE`, поэтому он обновит существующую запись. Если хотите создать нового организатора, используйте другой User ID

### Организатор не может войти

**Причины**:
- Email или пароль введены неправильно
- Пользователь не подтвержден (отключите требование подтверждения email при создании)
- Профиль не создан в таблице `profiles`

**Решение**:
1. Проверьте данные входа
2. Убедитесь, что профиль создан: `SELECT * FROM profiles WHERE email = 'email@example.com';`
3. Проверьте роль: `SELECT role FROM profiles WHERE id = 'USER_ID';` (должно быть `organizer`)

